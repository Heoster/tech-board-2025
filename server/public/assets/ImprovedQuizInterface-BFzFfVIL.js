import{u as e,r as s,j as t,d as r,T as a,C as l,E as i,G as n,e as d,f as o,F as c,g as x}from"./vendor-react-CY1O2pxN.js";import{u as m,a as u}from"./index-DMUTUhHV.js";import"./vendor-misc-IyfMy1hy.js";import"./vendor-utils-C-1G2k3o.js";const h=()=>{var h;const{user:b,isAuthenticated:g}=m(),f=e(),[j,p]=s.useState(null),[v,N]=s.useState(0),[y,w]=s.useState({}),[q,S]=s.useState(3e3),[k,C]=s.useState(!0),[z,E]=s.useState(!1),[T,G]=s.useState(!1),[I,A]=s.useState(null);s.useEffect(()=>{g||f("/login")},[g,f]),s.useEffect(()=>{b?(async()=>{var e,s,t,r;try{const e=null==b?void 0:b.grade;if(!e)throw new Error("Grade information not available. Please log in again.");const s=await u.post("/quiz/start",{grade:e});if(!s.data.success)throw new Error(s.data.error||"Quiz start failed");const t=s.data.data;if(!t||!t.questions||0===t.questions.length)throw new Error("No quiz questions received");p(t),S(3e3)}catch(a){const l=(null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||(null==(r=null==(t=a.response)?void 0:t.data)?void 0:r.message)||a.message||"Failed to start quiz";alert(`Quiz Error: ${l}`),f("/dashboard")}finally{C(!1)}})():(C(!1),f("/login"))},[b,f]),s.useEffect(()=>{if(!j||q<=0)return;const e=setInterval(()=>{S(e=>e<=1?(P(!0),0):e-1)},1e3);return()=>clearInterval(e)},[j]),s.useEffect(()=>{A(y[v]||null)},[v,y]);const Q=e=>{const s=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},P=async(e=!1)=>{var s,t;if(!z){if(!e){const e=50-Object.keys(y).length;if(e>0){if(!window.confirm(`You have ${e} unanswered questions. Are you sure you want to submit?`))return}}E(!0);try{if(!j)throw new Error("No quiz data");const e=j.questions.map((e,s)=>({questionId:e.id,selectedOptionId:y[s]||null}));await u.post("/quiz/submit",{quizId:j.quizId,answers:e,startTime:j.startTime}),f("/test-submitted")}catch(r){alert((null==(t=null==(s=r.response)?void 0:s.data)?void 0:t.error)||"Failed to submit quiz"),E(!1)}}};if(k)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:t.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-12 text-center max-w-lg",children:[t.jsxs("div",{className:"relative mb-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-20 w-20 border-4 border-blue-500 border-t-transparent mx-auto"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx(r,{className:"w-8 h-8 text-blue-500"})})]}),t.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Preparing Your Test"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Loading questions tailored for your grade..."}),b&&t.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200",children:t.jsxs("p",{className:"text-blue-700 font-medium",children:[t.jsx(r,{className:"inline w-5 h-5 mr-2"}),"Grade ",b.grade," • ",b.name]})})]})});if(!g||!b||!j)return t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center bg-white rounded-2xl shadow-xl p-8 max-w-md",children:[t.jsx(a,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Access Required"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Please log in to access the test."}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("button",{onClick:()=>f("/login"),className:"w-full bg-blue-600 text-white py-3 px-6 rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Go to Login"}),t.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-gray-100 text-gray-700 py-3 px-6 rounded-xl font-medium hover:bg-gray-200 transition-colors",children:"Retry Loading"})]})]})});const $=j.questions,R=(v+1)/$.length*100,F=Object.keys(y).length,L=q<=300,O=$[v];return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[t.jsx("header",{className:"bg-white/80 backdrop-blur-md shadow-lg border-b border-gray-200 sticky top-0 z-50",children:t.jsxs("div",{className:"container mx-auto px-4",children:[t.jsxs("div",{className:"flex items-center justify-between py-4",children:[t.jsxs("div",{className:"flex items-center space-x-6",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center",children:t.jsx(r,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Tech Board Selection Test"}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Grade ",b.grade," • ",b.name]})]})]}),t.jsxs("div",{className:"hidden md:flex items-center space-x-4",children:[t.jsxs("div",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:["Question ",v+1," of ",$.length]}),t.jsxs("div",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:[F," Answered"]})]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 px-4 py-2 rounded-xl font-mono font-bold "+(L?"bg-red-100 text-red-700 border border-red-300":"bg-gray-100 text-gray-700"),children:[t.jsx(l,{className:"w-5 h-5"}),t.jsx("span",{children:Q(q)}),L&&t.jsx("span",{className:"text-xs animate-pulse",children:"URGENT"})]}),t.jsx("button",{onClick:()=>G(!T),className:"bg-gray-100 hover:bg-gray-200 text-gray-700 p-2 rounded-xl transition-colors",title:"Question Grid",children:T?t.jsx(i,{className:"w-5 h-5"}):t.jsx(n,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>P(),disabled:z,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-6 py-2 rounded-xl font-medium transition-all disabled:opacity-50",children:z?"Submitting...":"Submit Test"})]})]}),t.jsxs("div",{className:"pb-4",children:[t.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[t.jsxs("span",{children:["Progress: ",Math.round(R),"%"]}),t.jsxs("span",{children:[F,"/",$.length," answered"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-indigo-500 transition-all duration-300 ease-out",style:{width:`${R}%`}})})]})]})}),T&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[80vh] overflow-y-auto",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Question Navigator"}),t.jsx("button",{onClick:()=>G(!1),className:"text-gray-500 hover:text-gray-700 p-2",children:"✕"})]})}),t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"grid grid-cols-10 gap-3",children:$.map((e,s)=>t.jsx("button",{onClick:()=>(e=>{N(e),G(!1)})(s),className:"w-12 h-12 rounded-xl text-sm font-bold transition-all "+(s===v?"bg-blue-600 text-white shadow-lg scale-110":void 0!==y[s]?"bg-green-100 text-green-800 border-2 border-green-300 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200 border-2 border-transparent"),children:s+1},s))}),t.jsxs("div",{className:"mt-6 flex items-center justify-center space-x-6 text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 bg-blue-600 rounded"}),t.jsx("span",{children:"Current"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 bg-green-100 border-2 border-green-300 rounded"}),t.jsx("span",{children:"Answered"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 bg-gray-100 border-2 border-gray-300 rounded"}),t.jsx("span",{children:"Unanswered"})]})]})]})]})}),t.jsx("main",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden",children:[t.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold mb-2",children:["Question ",v+1]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium "+("basic"===(null==O?void 0:O.difficulty)?"bg-green-500/20 text-green-100":"medium"===(null==O?void 0:O.difficulty)?"bg-yellow-500/20 text-yellow-100":"bg-red-500/20 text-red-100"),children:null==(h=null==O?void 0:O.difficulty)?void 0:h.toUpperCase()}),I&&t.jsxs("div",{className:"flex items-center space-x-1 bg-white/20 px-3 py-1 rounded-full",children:[t.jsx(d,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Answered"})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm opacity-80",children:"Time Remaining"}),t.jsx("div",{className:"text-xl font-mono font-bold",children:Q(q)})]})]})}),t.jsxs("div",{className:"p-8",children:[t.jsx("div",{className:"mb-8",children:t.jsx("p",{className:"text-xl text-gray-800 leading-relaxed font-medium",children:null==O?void 0:O.question_text})}),t.jsx("div",{className:"space-y-4 mb-8",children:null==O?void 0:O.options.map((e,s)=>t.jsx("button",{onClick:()=>{return s=e.id,A(s),void w(e=>({...e,[v]:s}));var s},className:"w-full p-6 text-left rounded-2xl border-2 transition-all duration-200 "+(I===e.id?"border-blue-500 bg-blue-50 text-blue-900 shadow-lg scale-[1.02]":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 hover:shadow-md"),children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold "+(I===e.id?"border-blue-500 bg-blue-500 text-white":"border-gray-300 text-gray-600"),children:String.fromCharCode(65+s)}),t.jsx("span",{className:"text-lg",children:e.text})]})},e.id))}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("button",{onClick:()=>{v>0&&N(e=>e-1)},disabled:0===v,className:"flex items-center space-x-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(o,{className:"w-5 h-5"}),t.jsx("span",{children:"Previous"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{className:"text-sm text-gray-600",children:[v+1," of ",$.length]}),t.jsxs("button",{onClick:()=>P(),disabled:z,className:"flex items-center space-x-2 px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-medium transition-all disabled:opacity-50",children:[t.jsx(c,{className:"w-5 h-5"}),t.jsx("span",{children:z?"Submitting...":"Submit Test"})]})]}),t.jsxs("button",{onClick:()=>{v<((null==j?void 0:j.questions.length)||0)-1&&N(e=>e+1)},disabled:v===$.length-1,className:"flex items-center space-x-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx("span",{children:"Next"}),t.jsx(x,{className:"w-5 h-5"})]})]})]})]}),t.jsx("div",{className:"mt-6 bg-amber-50 border border-amber-200 rounded-2xl p-6",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(a,{className:"w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-amber-800 mb-1",children:"Important Notice"}),t.jsx("p",{className:"text-amber-700 text-sm",children:"Test results are confidential and only visible to administration. You will be contacted directly if you qualify for the next round."})]})]})})]})})]})};export{h as default};
